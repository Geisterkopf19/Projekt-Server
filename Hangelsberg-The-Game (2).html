<script type="module">

    // import kaboom lib
    import kaboom from "https://unpkg.com/kaboom@3000.0.0-beta.5/dist/kaboom.mjs";

    kaboom({
        background: [0, 127, 70],
    })


    //Neue
    loadSprite("auto", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/auto.png")
    loadSprite("polizei_a", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/polizei-1.png", {
        sliceX: 3,
        anims: {
            "recht": 2,
            "links": 1,
        },
    })
    //end neue
    //Map
    loadSprite("Map-Button1", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Level1Buton.png")
    loadSprite("Map-Hintergrund", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/map.png")
    //Hause
    loadSprite("Hause1", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Haus(1).png")
    loadSprite("Hause2", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Haus(2).png")
    loadSprite("Hause3", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Haus(3).png")
    loadSprite("Hause4", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Haus(4).png")
    loadSprite("Hause5", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Haus(5.png")
    loadSprite("Hause6", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Haus(6).png")
    loadSprite("Hause7", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Haus(7).png")
    loadSprite("Hause8", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Haus(8).png")
    //Zaun
    loadSprite("Zaun2", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/z1.png")
    loadSprite("Zaun", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Zaune-lang.png")
    //hintergrund
    loadSprite("Tanebaum", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/baum-tane.png")
    loadSprite("Grass", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Grass.png")
    //Renddeam
    loadSprite("wand", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/wand.png")
    loadSprite("Straße", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Straße.png")
    //Himmel
    loadSprite("Wolken", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/wolke.png")
    loadSprite("Himmel", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/bk.png")
    //
    //Vogel
    loadSprite("Vogel", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Vogel.png", {
        sliceX: 7,
        anims: {
            "fly": { 
                from: 0,
                to: 6,
                speed: 9,
                loop: true,
            },
        },
    })
    //Objekte
    loadSprite("schild_sprung", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/schild.png")
    loadSprite("glas-au", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Glas.png")
    //mull
    loadSprite("Restmull", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Restm%C3%BCll-Tonne.png")
    loadSprite("Wertstoffe", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Wertstoffe-Tonne.png")
    loadSprite("Restmull2", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Resam%C3%BClltone.png")
    loadSprite("Papier-mull", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Papierm%C3%BClltone.png")
    //Music
    loadSound("Level-1", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Music/Level-1.mp3")        
    loadSound("Level-2", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Music/Level-2.mp3")        
    loadSound("Lobby-1", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Music/Lobby-1.mp3")        
    loadSound("Lobby-2", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Music/Lobby-2.mp3")        
    loadSound("Bahnhof", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Music/Bahnhof.mp3")        
    loadSprite("player", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/all2.png", {
        sliceX: 10,
        anims: {
            "run": { 
                from: 0,
                to: 6,
                speed: 10,
                loop: true,
            },

            "idle": { 
                from: 7,
                to: 8,
                speed: 1,
                loop: true,
            },
            "jump": 9,
        },
    })
    var Vogel_Timer = 0
    var eins = 1
    var lo = 0 
    var leben = 0 
    var MOVE_SPEED = 480
    var vogel_da = false
    var yend =  1300
    var jump = 600
    var grav = 1700
    var newcamhigt = 0
    var hx1 = 0 
    var hx2 = 100
    var hx3 = 0
    var gx3 = 0
    var tx = 0 
    var ty = 0
    var ivar = 0
    volume(0.5)
    scene("map", () => {
        camScale(1, 1)


        const background = add([
            sprite("Map-Hintergrund"),
            pos(0, 0),
            scale(4),
        ]);       

        function addlvButton(sp, p, f, s) {

            const btn = add([
                sprite(sp),
                pos(p),
                area({ cursor: "pointer", }),
            ])

            btn.onClick(f)
        }
        
        addlvButton("Map-Button1", vec2(1000, 600), () => go("Level-1"), )


        background.onUpdate(() => {
            if (isMouseDown() == true){
                camPos(mousePos())
            }
        })
    })

    scene("Level-1", () => {
        const backgrounds = [
            [0, 172, 70],
        ]
        var Vogel_Timer = 0
        var eins = 1
        var lo = 0 
        var leben = 0 
        var MOVE_SPEED = 480
        var vogel_da = false
        var yend =  1300
        var jump = 600
        var grav = 1700
        var newcamhigt = 0
        var hx1 = 0 
        var hx2 = 100
        var hx3 = 0
        var gx3 = 0
        var tx = 0 
        var ty = 0
        var ivar = 0

        const music = play("Level-1", {
            loop: true,
        })
        
        camScale(1.3, 1.3)
        setGravity(grav)

            //Polizei //
            const auto = add([
                sprite("auto"),
                pos(0, 130),
                area(), 
                scale(1.3),
                z(103),
            ])
            const polizei_a = add([
                sprite("polizei_a"),
                pos(0, 130),
                area(), 
                scale(1.3),
                z(103),
            ])
            const schild_sprung = add([
                sprite("schild_sprung"),
                pos(1040, 120),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(3),
                z(101),
            ])
            const player = add([
                sprite("player"),
                pos(840, 54),
                area(),
                scale(1),
                body(),
                z(100),
            ])             
            add([
                sprite("glas-au"),
                pos(2400, 200),
                scale(1),
                z(101),
                area(),
                "glas-au",
            ])
            add([
                sprite("glas-au"),
                pos(6300, 200),
                scale(1),
                z(101),
                area(),
                "glas-au",
            ])
            add([
                sprite("glas-au"),
                pos(4000, 200),
                scale(1),
                z(101),
                area(),
                "glas-au",
            ])
            add([
                sprite("glas-au"),
                pos(4900, 200),
                scale(1),
                z(101),
                area(),
                "glas-au",
            ])
            add([
                sprite("glas-au"),
                pos(7400, 200),
                scale(1),
                z(101),
                area(),
                "glas-au",
            ])
            add([
                sprite("glas-au"),
                pos(7900, 200),
                scale(1),
                z(101),
                area(),
                "glas-au",
            ])
            const straße = add([ 
                sprite("Straße"),
                area(),
                pos(0, 200),
                scale(2),
                body({ isStatic: true }),    
                "straße",
                z(99),
            ])
            const straße2 = add([ 
                sprite("Straße"),
                area(),
                pos(6000, 200),
                scale(2),
                body({ isStatic: true }),    
                "straße2",
                z(99),
            ])
            const straße3 = add([ 
                sprite("Straße"),
                area(),
                pos(3000, 200),
                scale(2),
                body({ isStatic: true }),    
                "straße2",
                z(99),
            ])
            const straße4 = add([ 
                sprite("Straße"),
                area(),
                pos(4500, 200),
                scale(2),
                body({ isStatic: true }),    
                "straße2",
                z(99),
            ])
            const Zaun = add([
                sprite("Zaun"),
                area(),
                pos(570, 100),
                scale(6),
                z(50),
                "Zaun",
            ])
            const wand = add([
                sprite("wand"),
                area(),
                pos(630, 54),
                scale(2),
                body({ isStatic: true }),    
                "wand",
                z(999),
            ])           
            const Hause1 = add([
                sprite("Hause1"),
                area(),
                pos(100, -290),
                scale(6),
                "Hause1",
                z(98),
            ])
            add([
                sprite("Papier-mull"),
                pos(400, 80),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            add([
                sprite("Wertstoffe"),
                pos(1800, 80),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            const Hause2 = add([
                sprite("Hause2"),
                area(),
                pos(970, -255),
                scale(6),
                "Hause2",
                z(97),
            ])
            add([
                sprite("Papier-mull"),
                pos(1400, 100),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            const Hause3 = add([
                sprite("Hause3"),
                area(),
                pos(1750, -207),
                scale(6),
                "Hause3",
                z(96),
            ])
            add([
                sprite("Papier-mull"),
                pos(2100, 100),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            const Hause4 = add([
                sprite("Hause4"),
                area(),
                pos(2500, -75),
                scale(6),                
                "Hause4",
                z(95),
            ])
            const Hause5 = add([
                sprite("Hause5"),
                area(),
                pos(3750, -280),
                scale(4),                
                "Hause5",
                z(95),
            ])
            add([
                sprite("Papier-mull"),
                pos(4250, 100),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            const Hause6 = add([
                sprite("Hause6"),
                area(),
                pos(5000, -155),
                scale(3.5),                
                "Hause6",
                z(95),
            ])
            add([
                sprite("Papier-mull"),
                pos(5800, 100),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            const Hause7 = add([
                sprite("Hause7"),
                area(),
                pos(6500, -125),
                scale(3),                
                "Hause7",
                z(95),
            ])
            add([
                sprite("Papier-mull"),
                pos(6800, 100),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            const Wertstoffe = add([
                sprite("Wertstoffe"),
                pos(3000, 100),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            const Restmull = add([
                sprite("Restmull"),
                pos(2800, 100),
                area(),
                body({ isStatic: true }),
                offscreen({ hide: true }),
                scale(1),
                z(101),
            ])
            polizei_a.play("recht")
            player.play("idle")


            //cam
            player.onCollide("glas-au", () => {
                go("map")
            })  
        // onUpdate
            player.onUpdate(() => {        
                //colid
                if(leben == 0){
                    go("map")
                } 
                // bot camera to player
                if(eins = 1){
                //polizei_a.move(400, 0)
                }
                
                if (player.pos.x < polizei_a.pos.x + 200) {
                    go("map")
                }

                if (player.pos.y > yend) {
                    go("map")
                    
                }
                if (!player.isGrounded()) {                
                    camPos(player.pos.x, player.pos.y - 80)
                }


                if (player.isGrounded() && !isKeyDown("left") && !isKeyDown("right")&& !isKeyDown("a") && !isKeyDown("d")) {
                        player.play("idle")
                }
                
                if (!player.isGrounded()) {
                    player.play("jump")
                } 
                


            })


            //Vogel
            Vogel_Timer = rand(10, 20)
                loop(Vogel_Timer, () => {
                    const vx = player.pos.x + 1000
                    const vy = rand(-200, -250)
                    vogel_da = true 

                    const vogel = add([
                        sprite("Vogel"),
                        pos(vx, -300),
                        z(3),
                        area(),
                        scale(6),
                        "vogel",
                    ])
                    
                    loop(0.1,() => {
                        vogel.move(-MOVE_SPEED * 3, 0)
                    })

                    wait(1, () => {
                        vogel.play("fly")
                    })
                    
                    wait(24, () => {
                        destroy(vogel)
                    })
                    
                })
            //Grass / Baum Gen 

            for (let i = 0; i < 40; i++) {
                
                add([
                    sprite("Grass"),
                    pos(gx3, 150),
                    z(1),
                    area(),
                    scale(1),
                ])
                ivar = rand(1, 2)
                for (let i = 0; i < ivar; i++) {
                    tx = rand(gx3 - 170, gx3 + 170)
                    ty = rand(-20, -35)
                    add([
                        sprite("Tanebaum"),
                        pos(tx, ty),
                        z(2),
                        area(),
                        scale(2.4),
                    ])
                }
                gx3 = gx3 + 341
            }

            // Himmel 
            for (let i = 0; i < 20; i++) {

                add([
                    sprite("Himmel"),
                    pos(hx3, -700),
                    z(1),
                    area(),
                    scale(6),
                ])
                hx1 = hx3 + 350
                hx2 = hx3 - 350
                
                for (let i = 0; i < 3; i++) {


                    const wx1 = rand(hx1, hx2)
                    const wy1 = rand(-200, -350)
                    
                    add([
                        sprite("Wolken"),
                        scale(6),
                        z(2),
                        pos(wx1, wy1),
                    ])
                    
                    
                }

                hx3 = hx3 + 600
            }

        // Input
                onKeyPress("t", () => {
                    go("map");
                })

            //Jump
                onKeyPress("space", () => {
                    if (player.isGrounded()) {     

                        player.jump(jump);
                        camPos(player.pos.x, player.pos.y - 80)
                    }
                })

                onKeyPress("up", () => {
                    if (player.isGrounded()) {                
                        player.jump(jump);
                        camPos(player.pos.x, player.pos.y - 80)

                    }
                })

                onKeyPress("w", () => {
                    if (player.isGrounded()) {                
                        player.jump(jump);
                        camPos(player.pos.x, player.pos.y - 80)
                    }
                })              
            //Links
                onKeyDown("a", () => {
                    player.move(-MOVE_SPEED, 0)
                    camPos(player.pos.x, player.pos.y - 80)
                    player.flipX = true
                    //Animation
                    if (player.isGrounded() && player.curAnim() !== "run") {
                        player.play("run")
                    }
                })
            //Rechts
                onKeyDown("d", () => {
                    player.move(MOVE_SPEED, 0)
                    camPos(player.pos.x, player.pos.y - 80)
                    player.flipX = false
                    //Animation
                    if (player.isGrounded() && player.curAnim() !== "run") {
                        player.play("run")
                    }
                })

    })
    go("Level-1");
    </script>
</body>
</html>
