<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script type="module">

        import kaboom from "https://unpkg.com/kaboom/dist/kaboom.mjs";
        
        kaboom({
            font: "sinko",
        })

        loadSprite("Map-Button1", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Level1Buton.png")
        loadSprite("Map-Hintergrund", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/map-1.png")
        loadSprite("Straße", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/Straße.png")
        
        loadSprite("player", "https://raw.githubusercontent.com/Geisterkopf19/Projekt-Server/main/all2.png", {
            // The image contains 9 frames layed out horizontally, slice it into individual frames
            sliceX: 9,
            // Define animations
            anims: {
                "run": { 
                    from: 0,
                    to: 6,
                    speed: 10,
                    loop: true,
                },
                // This animation only has 1 frame
                "idle": { 
                    from: 7,
                    to: 8,
                    speed: 1,
                    loop: true,
                },
            },
        })
        
        var lo = 0 
        var MOVE_SPEED = 480
        var yend =  1300
        var jump = 200
        var grav = 500
        var newcamhigt = 50
        scene("map", () => {
            camScale(1, 1)


            const background = add([
                sprite("Map-Hintergrund"),
                pos(200, 400),
                scale(1),
            ]);       

            function addlvButton(sp, p, f) {

                const btn = add([
                    sprite(sp),
                    pos(p),
                    area({ cursor: "pointer", }),
                ])

                btn.onClick(f)

            }
            
            addlvButton("Map-Button1", vec2(1000, 600), () => go("Level-1"))


            background.onUpdate(() => {
                if (isMouseDown() == true){
                    camPos(mousePos())
                }
            })
        })

        scene("Level-1", () => {

            camScale(2, 2) 
            setGravity(grav)
            //Add Objekt
                const straße = add([
                    sprite("Straße"),
                    area(),
                    body({isStatic: true}),
                    pos(0, 200),
                    scale(2),
                    "straße",
                ])
                const player = add([
                    sprite("player"),
                    pos(0, -90),
                    area(),
                    scale(1),
                    body(),
                ])
                player.play("idle")
 

            // onUpdate
                player.onUpdate(() => {
                    // bot camera to player
                    camPos(player.pos.x, player.pos.y + newcamhigt)
                    // check fall death

                    if (player.pos.y > yend) {
                        go("map")
                        
                    }
                    if (player.isGrounded() && !isKeyDown("left") && !isKeyDown("right")&& !isKeyDown("a") && !isKeyDown("d")) {
                            player.play("idle")
                    }
                })


            // Input
                    onKeyPress("t", () => {
                        go("map");
                    })

                //Jump
                    onKeyPress("space", () => {
                        if (player.isGrounded()) {                
                            player.jump(jump);
                            setGravity(grav)
                        }
                    })

                    onKeyPress("up", () => {
                        if (player.isGrounded()) {                
                            player.jump(jump);
                            setGravity(grav)
                        }
                    })

                    onKeyPress("w", () => {
                        if (player.isGrounded()) {                
                            player.jump(jump);
                            setGravity(grav)
                        }
                    })              
                
                //Links
                    onKeyDown("a", () => {
                        player.move(-MOVE_SPEED, 0)
                        player.flipX = true
                        //Animation
                        if (player.isGrounded() && player.curAnim() !== "run") {
                            player.play("run")
                        }
                    })
                //Rechts
                    onKeyDown("d", () => {
                        player.move(MOVE_SPEED, 0)
                        player.flipX = false
                        //Animation
                        if (player.isGrounded() && player.curAnim() !== "run") {
                            player.play("run")
                        }
                    })

        })
        go("Level-1");
    </script>
</body>
</html>
